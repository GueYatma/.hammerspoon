#!/bin/sh

set -e

commit_msg=$(git log -1 --pretty=%s)
if [ -z "$commit_msg" ]; then
  exit 0
fi

if command -v python3 >/dev/null 2>&1; then
  encoded=$(python3 - <<'PY' "$commit_msg"
import sys, urllib.parse
print(urllib.parse.quote(sys.argv[1]))
PY
)
else
  encoded=$(printf '%s' "$commit_msg" | sed -e 's/ /%20/g')
fi

open -g "hammerspoon://gitpush?status=ok&commit=${encoded}"
